{% extends 'flashcard-base.html' %}
{% load static %}

{% block title %}Discere{% endblock %}

{% block main_content %}
<div class="bg-white1 flex-grow px-10 py-10 rounded-t-3xl min-h-full">
    <div class="flex justify-between items-center mb-4">
        <a href="{% url 'library' %}" class="flex items-center">
            <img src="{% static 'icons/arrow-left.svg' %}" alt="Back" class="h-10 w-10 mr-2 text-darkgreen fill-current mt-2">
        </a>
        
        <h1 class="text-xl font-bold text-4xl ml-[-80px]">
            {{study_set.set_name}}
        </h1>

        <div class="flex space-x-4">
            <button id="open-modal"
                    class="text-darkgreen font-semibold py-2 px-4 rounded-full w-64 h-16 flex items-center justify-center text-lg border-4 border-[#012d19] hover:bg-[#012d19] hover:text-white hover:border-transparent">
                <i class="fa fa-magic mr-2 text-sm"></i>
                Create Flashcard
            </button>

            <a href="{% url 'flashcard_viewer' study_set_id=study_set.id %}" id="start-learning-link">
                <button id="start-learning"
                        class="bg-darkgreen text-white font-semibold py-2 px-4 rounded-full w-64 h-16 flex items-center justify-center text-lg hover:bg-[#07663a]">
                    <img src="{% static 'icons/play.svg' %}" alt="icon" class="h-7 w-7 mr-2">
                    Start Learning
                </button>
            </a>

            <div class="h-[65px] border-t border-transparent ml-10"></div>

            <form method="POST" action="{% url 'delete_study_set' study_set_id=study_set.id %}" id="delete-study-set-form">
                {% csrf_token %}
                <button type="submit" id="delete"
                        class="font-semibold py-2 px-4 rounded-full w-20 h-16 flex items-center justify-center text-lg text-[#a12d1a] border-4 border-[#a12d1a] hover:bg-[#a12d1a] hover:text-white">
                    <i class="fa fa-trash"></i>
                </button>
            </form>
        </div>
    </div>

    <div class="w-full h-px bg-opacity-10 mb-4 border-t border-lightgrey mt-10"></div>

    <div class="text-right flex justify-between items-center text-2xl">
        <div class="bg-white rounded-b-lg flex border-3 border-lightgrey">
            <div class="text-[#012d19] px-5 py-2">
                <strong class="text-[#012d19]">SET SUBJECT</strong>
            </div>
            <div class="bg-[#012d19] text-white rounded-br-lg px-5 py-2 border-l-3 border-lightgrey">
                {{study_set.set_subject}}
            </div>
        </div>

        <div class="bg-white rounded-b-lg flex border-3 border-lightgrey ml-4">
            <div class="text-[#012d19] px-5 py-2">
                <strong class="text-[#012d19]">FLASHCARD COUNT</strong>
            </div>
            <div class="bg-[#012d19] text-white rounded-br-lg px-5 py-2 border-l-3 border-lightgrey" id="flashcard-counter">
                1
            </div>
        </div>
    </div>

    <div class="py-10">
        <form method="POST" action="{% url 'flashcard_view' %}">
            {% csrf_token %}
            <input type="hidden" name="study_set" value="{{study_set.id}}">

            <div id="flashcards">
                <div class="flashcard">
                    <div class="flashcard-header">
                        <span class="flashcard-number">1</span>
                        <button type="button" class="delete-btn">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>

                    <div class="flashcard-content">
                        <div class="input-group">
                            <input type="text"
                                   name="term_1"
                                   class="input-term border border-gray-300 rounded p-2 w-full"
                                   placeholder="Enter term" required>
                            <p class="label">TERM</p>
                        </div>

                        <div class="input-group">
                            <input type="text"
                                   name="definition_1"
                                   class="input-definition border border-gray-300 rounded p-2 w-full"
                                   placeholder="Enter definition" required>
                            <p class="label">DEFINITION</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="add-card-section mt-4">
                <div class="add-card">
                    <button type="button" class="add-card-btn text-darkgreen font-semibold border-4 border-[#012d19] py-2 px-4 rounded-full w-64 h-16 flex items-center justify-center text-lg hover:bg-[#012d19] hover:text-white">
                        <i class="fas fa-plus mr-2"></i> ADD CARD
                    </button>
                </div>
            </div>

            <div class="flex justify-end items-center mr-36 mb-2">
                <button class="text-darkgreen font-semibold py-2 px-4 rounded-full w-64 h-16 flex items-center justify-center text-lg border-4 border-[#012d19] hover:bg-[#012d19] hover:text-white" type="submit">
                    <i class="fa fa-magic mr-2 text-sm"></i>
                    Create Flashcard
                </button>
            </div>
        </form>

        <div id="modal" class="modal">
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <div class="warning-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <p class="warning-message">This is the last flashcard of the set.<br>Unable to delete!</p>
            </div>
        </div>

        <script src="{% static 'flashcards/js/flashcards.js' %}"></script>
        <script>
            document.getElementById("open-modal").addEventListener("click", function() {
                document.querySelector("form").submit();
            });

            document.getElementById("start-learning").addEventListener("click", function(e) {
                e.preventDefault();
                document.querySelector("form").submit();  
                setTimeout(function() {
                    window.location.href = document.getElementById("start-learning-link").href;
                }, 100);
            });

            document.getElementById("delete").addEventListener("click", function(e) {
                e.preventDefault();  
                if (confirm("Are you sure you want to delete this study set? This action cannot be undone.")) {
                    document.getElementById("delete-study-set-form").submit();  
                }
            });
        </script>
    </div>
</div>
{% endblock %}
